(ns olda.corpus)

(defn extract-path
  "Given a string file path-to-file/file-name extract path-to-file/"
  [s]
  
  (re-find #".*/" s))

(defn extract-name
  "Givena strinng path-to-file/file-name extract file-name"
  [s]
  
  (re-find #"[^/]*$" s))

(defn get-path
  "Given a vector of documents' representations and document index get its path"
  [idx corpora]
  (:path (nth corpora idx)))

(defn get-name
  "Given a vector documents' representations and document index get its name"
  [idx corpora]
  (:name (nth corpora idx)))

(defn get-idx
  "Given a vector of document's representations, a document's path and name  get its index in the vector"
  [path name corpora]
  (loop [corpora corpora
         index 0]
    (if (and (-> corpora first :path (= path))
             (-> corpora first :path (= name)))
      index
      (recur (rest corpora)
             (inc index)))))

(defn get-indices
  "Get all available document indices for a Mallet model's data"
  [corpora]
  (-> corpora count range))

;; load and init a corpora based on dicretcory path

(defn struct-corpora
  "Given a directory path return a vector of document representations
  i.e. [{:path directory-path :name a-document's-file-name :pproc-fns :empty}
        ...]"
  
  [dir-path]
  (let [files (.listFiles (io/file dir-path))]
    (into []
          (map #(hash-map :path (-> % str extract-path)
                          :name (-> % str extract-name)
                          :pproc-fns :empty))
          files)))
